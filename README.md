# TOOL    
分为无锁队列，异步日志，文件传输三个模块，打算写一个linux平台高性能的网络文件传输工具。  
无锁队列基于cas实现，异步日志基于生产者消费者模型实现，文件传输采用常规的头+socket传输，为了高性能加入epoll和mmap，打算将三个模块组合一起提供不同的传输组合方式：  
无锁队列+线程池或者有锁线程池

log计划：  
713:
buffer已经完成：做成双链表，head存储持久化信息，data存储实际日志内容，节点本身可以将内容写入文件中  
log：写：每次先访问head观察状态，可写才进行写操作，利用buffer本身的写功能进行写操作 考虑head中偏移信息和文件位置  
追加：向product节点追加数据 利用format进行格式化数据 每次追加即可  

计划：实现子线程持久化逻辑 完善接口和工具宏 完成测试功能


714:  
完成：
完善了生产者和消费者逻辑以及持久化逻辑，完成了工具宏的封装，通过了编译无明显bug，未完成接口的测试   
  
问题：freelockqueue存在bug：1.大量任务环境以及多线程环境下会有segmention 2.死锁  segment在偶然情况下有 任务数量超过100000时大概率下死锁

计划：明天完成所有功能测试并且改进逻辑 完成多线程下的读写测试

715:
完成：  
修复freelockqueue死锁行为 大量任务偶然情况下仍然有segment，猜测：队列空情况时函数行为badalloc  
完善log逻辑 仍然存在问题：可变参数部分参数未能正确写入，开头leek造成大量无效字符  

计划：  
完成log和freelockqueue的bug修复
  
716：  
完成：  
log的工具宏封装，解决seek时大量NULL的bug，测试所有接口，目前由于采用加锁的方式 IO性能极低；完善了freelockqueue的bug定位：对于队列为空情况仍然可能发生pop行为即使采用了cas方式   
    
 计划：  
 改进log加锁解决同步问题的方式，改进接口命名；解决freelockqueue的badalloc的bug。

  
717:  
完成：  
Filets的封装测试  
计划：存在重定义BUG，优雅方式去完成，封装线程池，提供有锁无锁线程池实现任务的切分  

  
718:  
完成：  
重新设置目录，完善功能测试代码，解决重定义BUG  
计划：规范命名，增加功能
